<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            padding: 20px;
            color: #e8e8e8;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .school-logo {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
        }
        
        .school-logo img {
            width: 120px;
            height: auto;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        
        .header {
            text-align: center;
            padding: 40px 20px;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.8em;
            font-weight: 700;
            background: linear-gradient(135deg, #e94560, #f39c12);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 15px;
            text-shadow: 0 4px 30px rgba(233, 69, 96, 0.3);
        }
        
        .header .subtitle {
            color: #8892b0;
            font-size: 1.2em;
            font-weight: 400;
        }
        
        /* –°–µ–∫—Ü–∏—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ */
        .auth-section {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            margin: 0 auto 40px auto;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
            animation: fadeIn 0.5s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .auth-section h2 {
            color: #e94560;
            margin-bottom: 25px;
            font-size: 1.5em;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .auth-section h2::before {
            content: 'üîê';
            font-size: 1.2em;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 10px;
            color: #8892b0;
            font-size: 1em;
            font-weight: 500;
        }
        
        .form-group input {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            font-size: 16px;
            background: rgba(0, 0, 0, 0.3);
            color: #e8e8e8;
            transition: all 0.3s ease;
        }
        
        .form-group input::placeholder {
            color: #5a6a8a;
        }
        
        .form-group input:focus {
            border-color: #e94560;
            box-shadow: 0 0 0 4px rgba(233, 69, 96, 0.2);
            outline: none;
        }
        
        .submit-btn {
            width: 100%;
            background: linear-gradient(135deg, #e94560, #f39c12);
            color: white;
            border: none;
            padding: 16px;
            font-size: 1.1em;
            font-weight: 600;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 6px 20px rgba(233, 69, 96, 0.3);
        }
        
        .submit-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(233, 69, 96, 0.4);
        }
        
        .submit-btn:active {
            transform: translateY(-1px);
        }
        
        .error-message {
            color: #ff6b6b;
            background: rgba(255, 107, 107, 0.1);
            border: 1px solid rgba(255, 107, 107, 0.3);
            padding: 12px 16px;
            border-radius: 10px;
            margin-top: 15px;
            display: none;
            animation: shake 0.5s ease;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        /* –°–µ–∫—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ */
        .results-section {
            display: none;
            animation: fadeIn 0.5s ease-out;
        }
        
        .class-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
            animation: slideUp 0.5s ease-out;
        }
        
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .class-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(233, 69, 96, 0.3);
        }
        
        .class-name {
            font-size: 1.6em;
            font-weight: 700;
            color: #e94560;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .class-name::before {
            content: 'üìö';
            font-size: 1em;
        }
        
        .student-count {
            background: linear-gradient(135deg, #e94560, #f39c12);
            color: white;
            padding: 8px 16px;
            border-radius: 25px;
            font-size: 0.9em;
            font-weight: 600;
        }
        
        .results-table {
            width: 100%;
            border-collapse: collapse;
            overflow: hidden;
            border-radius: 12px;
        }
        
        .results-table thead {
            background: rgba(233, 69, 96, 0.2);
        }
        
        .results-table th {
            padding: 16px 20px;
            text-align: left;
            color: #e94560;
            font-weight: 600;
            font-size: 0.95em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .results-table tbody tr.student-row {
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .results-table tbody tr.student-row:hover {
            background: rgba(255, 255, 255, 0.08);
        }
        
        .results-table td {
            padding: 16px 20px;
            color: #e8e8e8;
            font-size: 1em;
        }
        
        .student-row td:first-child::before {
            content: 'üë§ ';
        }
        
        .expand-icon {
            display: inline-block;
            margin-left: 10px;
            transition: transform 0.3s ease;
            font-size: 0.8em;
        }
        
        .student-row.expanded .expand-icon {
            transform: rotate(180deg);
        }
        
        .score-badge {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.95em;
        }
        
        .score-excellent {
            background: rgba(46, 204, 113, 0.2);
            color: #2ecc71;
            border: 1px solid rgba(46, 204, 113, 0.3);
        }
        
        .score-good {
            background: rgba(52, 152, 219, 0.2);
            color: #3498db;
            border: 1px solid rgba(52, 152, 219, 0.3);
        }
        
        .score-average {
            background: rgba(241, 196, 15, 0.2);
            color: #f1c40f;
            border: 1px solid rgba(241, 196, 15, 0.3);
        }
        
        .score-poor {
            background: rgba(231, 76, 60, 0.2);
            color: #e74c3c;
            border: 1px solid rgba(231, 76, 60, 0.3);
        }
        
        .level-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 0.85em;
            font-weight: 500;
            background: rgba(155, 89, 182, 0.2);
            color: #9b59b6;
            border: 1px solid rgba(155, 89, 182, 0.3);
        }
        
        /* –î–µ—Ç–∞–ª–∏ —É—á–µ–Ω–∏–∫–∞ */
        .student-details {
            display: none;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            margin: 10px 20px 20px 20px;
            padding: 20px;
            animation: fadeIn 0.3s ease-out;
        }
        
        .student-details.visible {
            display: block;
        }
        
        .details-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            color: #8892b0;
            font-size: 0.95em;
        }
        
        .answers-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .answer-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            border-radius: 10px;
            font-size: 0.95em;
        }
        
        .answer-correct {
            background: rgba(46, 204, 113, 0.15);
            border: 1px solid rgba(46, 204, 113, 0.3);
        }
        
        .answer-incorrect {
            background: rgba(231, 76, 60, 0.15);
            border: 1px solid rgba(231, 76, 60, 0.3);
        }
        
        .answer-icon {
            font-size: 1.2em;
        }
        
        .answer-text {
            flex: 1;
        }
        
        .answer-text .question-num {
            color: #8892b0;
            font-weight: 600;
        }
        
        .answer-text .answer-value {
            margin-left: 8px;
        }
        
        .answer-correct .answer-value {
            color: #2ecc71;
        }
        
        .answer-incorrect .answer-value {
            color: #e74c3c;
        }
        
        .correct-answer-hint {
            font-size: 0.85em;
            color: #8892b0;
            margin-left: 5px;
        }
        
        .question-block {
            background: rgba(0, 0, 0, 0.15);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
        }
        
        .question-header {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            margin-bottom: 12px;
        }
        
        .question-icon {
            font-size: 1.3em;
            flex-shrink: 0;
        }
        
        .question-content {
            flex: 1;
        }
        
        .question-title {
            color: #e94560;
            font-weight: 600;
            font-size: 0.9em;
            margin-bottom: 6px;
        }
        
        .question-text-full {
            color: #e8e8e8;
            font-size: 1em;
            line-height: 1.5;
            margin-bottom: 10px;
        }
        
        .answer-info {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            font-size: 0.9em;
        }
        
        .answer-label {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 8px;
        }
        
        .answer-label.user-answer {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .answer-label.correct-answer {
            background: rgba(46, 204, 113, 0.2);
            color: #2ecc71;
        }
        
        .answer-label.wrong-answer {
            background: rgba(231, 76, 60, 0.2);
            color: #e74c3c;
        }
        
        .question-block.correct-block {
            border-left: 4px solid #2ecc71;
        }
        
        .question-block.incorrect-block {
            border-left: 4px solid #e74c3c;
        }
        
        /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –≤–æ–ø—Ä–æ—Å–∞–º */
        .questions-stats-section {
            margin-top: 30px;
        }
        
        .questions-stats-title {
            color: #e8e8e8;
            font-size: 1.1em;
            font-weight: 600;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .test-level-group {
            background: rgba(0, 0, 0, 0.15);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .test-level-title {
            color: #9b59b6;
            font-size: 1em;
            font-weight: 600;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(155, 89, 182, 0.3);
        }
        
        .question-stat-item {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 12px;
        }
        
        .question-stat-item:last-child {
            margin-bottom: 0;
        }
        
        .question-stat-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }
        
        .question-stat-text {
            flex: 1;
            color: #e8e8e8;
            font-size: 0.95em;
            line-height: 1.4;
            padding-right: 15px;
        }
        
        .question-stat-number {
            color: #e94560;
            font-weight: 600;
            margin-right: 8px;
        }
        
        .question-stat-respondents {
            color: #8892b0;
            font-size: 0.85em;
            white-space: nowrap;
        }
        
        .question-stat-bar-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .question-stat-bar {
            flex: 1;
            height: 24px;
            background: rgba(231, 76, 60, 0.3);
            border-radius: 12px;
            overflow: hidden;
            display: flex;
        }
        
        .question-stat-bar-correct {
            height: 100%;
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.8em;
            font-weight: 600;
            min-width: 40px;
            transition: width 0.5s ease;
        }
        
        .question-stat-bar-incorrect {
            height: 100%;
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.8em;
            font-weight: 600;
            min-width: 40px;
            flex: 1;
        }
        
        .question-stat-bar-correct:empty,
        .question-stat-bar-incorrect:empty {
            min-width: 0;
        }
        
        .question-stat-legend {
            display: flex;
            gap: 15px;
            margin-top: 8px;
            font-size: 0.85em;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .legend-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }
        
        .legend-dot.correct {
            background: #2ecc71;
        }
        
        .legend-dot.incorrect {
            background: #e74c3c;
        }
        
        .legend-text {
            color: #8892b0;
        }
        
        .no-results {
            text-align: center;
            padding: 60px 20px;
            color: #8892b0;
            font-size: 1.2em;
        }
        
        .no-results::before {
            content: 'üìã';
            display: block;
            font-size: 3em;
            margin-bottom: 20px;
        }
        
        .logout-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: #8892b0;
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
            margin-bottom: 30px;
        }
        
        .logout-btn:hover {
            background: rgba(233, 69, 96, 0.2);
            color: #e94560;
            border-color: rgba(233, 69, 96, 0.3);
        }
        
        .stats-bar {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            margin-bottom: 30px;
        }
        
        .stat-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px 30px;
            text-align: center;
            flex: 1;
            min-width: 150px;
        }
        
        .stat-number {
            font-size: 2em;
            font-weight: 700;
            color: #e94560;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #8892b0;
            font-size: 0.9em;
        }
        
        /* –°–µ–∫—Ü–∏—è –æ–±—â–µ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ */
        .global-stats-section {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            margin-top: 40px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
        }
        
        .global-stats-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(233, 69, 96, 0.3);
        }
        
        .global-stats-header h2 {
            font-size: 1.5em;
            font-weight: 700;
            color: #e94560;
        }
        
        .global-stats-header::before {
            content: 'üìä';
            font-size: 1.5em;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stats-card {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
        }
        
        .stats-card-value {
            font-size: 2.5em;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .stats-card-value.excellent {
            color: #2ecc71;
        }
        
        .stats-card-value.good {
            color: #3498db;
        }
        
        .stats-card-value.average {
            color: #f1c40f;
        }
        
        .stats-card-value.poor {
            color: #e74c3c;
        }
        
        .stats-card-value.neutral {
            color: #e94560;
        }
        
        .stats-card-label {
            color: #8892b0;
            font-size: 1em;
        }
        
        .level-stats {
            margin-top: 20px;
        }
        
        .level-stats-title {
            color: #e8e8e8;
            font-size: 1.1em;
            font-weight: 600;
            margin-bottom: 15px;
        }
        
        .level-stat-row {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.15);
            border-radius: 10px;
            margin-bottom: 10px;
        }
        
        .level-stat-name {
            min-width: 150px;
            color: #9b59b6;
            font-weight: 600;
        }
        
        .level-stat-bar {
            flex: 1;
            height: 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            overflow: hidden;
        }
        
        .level-stat-fill {
            height: 100%;
            border-radius: 6px;
            transition: width 0.5s ease;
        }
        
        .level-stat-value {
            min-width: 80px;
            text-align: right;
            font-weight: 600;
        }
        
        .click-hint {
            text-align: center;
            color: #5a6a8a;
            font-size: 0.9em;
            margin-top: 15px;
            font-style: italic;
        }
        
        /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–ª—è –∫–ª–∞—Å—Å–∞ */
        .class-stats-section {
            margin-top: 25px;
            padding-top: 25px;
            border-top: 2px dashed rgba(255, 255, 255, 0.1);
        }
        
        .class-stats-header h3 {
            color: #e94560;
            font-size: 1.3em;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .class-questions-stats {
            margin-bottom: 20px;
        }
        
        .class-stats-title {
            color: #e8e8e8;
            font-size: 1.1em;
            font-weight: 600;
            margin-bottom: 15px;
            padding-left: 5px;
        }
        
        .class-test-group {
            background: rgba(0, 0, 0, 0.15);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .class-question-stat {
            background: rgba(255, 255, 255, 0.02);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
        }
        
        .class-question-stat .question-stat-text {
            font-size: 0.95em;
        }
        
        .global-stats-hint {
            text-align: center;
            margin-top: 25px;
            padding: 15px;
            background: rgba(233, 69, 96, 0.1);
            border-radius: 10px;
            border: 1px dashed rgba(233, 69, 96, 0.3);
        }
        
        .global-stats-hint p {
            color: #8892b0;
            font-size: 1em;
            margin: 0;
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2em;
            }
            
            .auth-section, .class-card, .global-stats-section {
                padding: 25px;
            }
            
            .results-table th, .results-table td {
                padding: 12px 10px;
                font-size: 0.9em;
            }
            
            .class-header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .answers-list {
                gap: 10px;
            }
            
            .question-block {
                padding: 12px;
            }
            
            .answer-info {
                flex-direction: column;
                gap: 8px;
            }
            
            .student-details {
                margin: 10px 10px 20px 10px;
            }
        }
    </style>
</head>
<body>
    <div class="school-logo">
        <img src="/static/logo.png" alt="–õ–æ–≥–æ—Ç–∏–ø —à–∫–æ–ª—ã">
    </div>
    
    <div class="container">
        <div class="header">
            <h1>–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã</h1>
            <p class="subtitle">–°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —É—á–µ–Ω–∏–∫–æ–≤</p>
        </div>
        
        <!-- –°–µ–∫—Ü–∏—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
        <div class="auth-section" id="authSection">
            <h2>–î–æ—Å—Ç—É–ø –¥–ª—è —É—á–∏—Ç–µ–ª—è</h2>
            <form id="authForm">
                <div class="form-group">
                    <label for="teacherKey">–í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á –¥–æ—Å—Ç—É–ø–∞</label>
                    <input type="password" id="teacherKey" name="teacherKey" required 
                           placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á...">
                </div>
                <button type="submit" class="submit-btn">–ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</button>
                <div class="error-message" id="errorMessage"></div>
            </form>
        </div>
        
        <!-- –°–µ–∫—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ -->
        <div class="results-section" id="resultsSection">
            <button class="logout-btn" onclick="logout()">
                <span>üîí</span> –í—ã–π—Ç–∏
            </button>
            
            <div class="stats-bar" id="statsBar">
                <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ —á–µ—Ä–µ–∑ JavaScript -->
            </div>
            
            <div id="classesContainer">
                <!-- –¢–∞–±–ª–∏—Ü—ã –ø–æ –∫–ª–∞—Å—Å–∞–º –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
            </div>
            
            <!-- –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
            <div class="global-stats-section" id="globalStatsSection">
                <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ —á–µ—Ä–µ–∑ JavaScript -->
            </div>
        </div>
    </div>

    <script>
        let allData = null;
        
        // –ë–∞–∑–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –¥–ª—è –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
        const QUESTIONS_DB = {
            // 9-11 –∫–ª–∞—Å—Å - –õ—ë–≥–∫–∏–π
            '4_easy': {
                1: '–ö–∞–∫ –∑–≤–∞–ª–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Ä–æ—Å—Å–∏–π—Å–∫–æ–≥–æ –∏–º–ø–µ—Ä–∞—Ç–æ—Ä–∞?',
                2: '–ö–∞–∫–æ–µ —Å–æ–±—ã—Ç–∏–µ –ø—Ä–æ–∏–∑–æ—à–ª–æ 7 –Ω–æ—è–±—Ä—è 1917 –≥–æ–¥–∞ (–ø–æ —Å—Ç–∞—Ä–æ–º—É —Å—Ç–∏–ª—é)?',
                3: '–ö—Ç–æ –±—ã–ª –í–µ—Ä—Ö–æ–≤–Ω—ã–º –ì–ª–∞–≤–Ω–æ–∫–æ–º–∞–Ω–¥—É—é—â–∏–º –°–°–°–† –≤ –≥–æ–¥—ã –í–µ–ª–∏–∫–æ–π –û—Ç–µ—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–π –≤–æ–π–Ω—ã?',
                4: '–ö–∞–∫ –Ω–∞–∑—ã–≤–∞–ª–∞—Å—å –ø–æ–ª–∏—Ç–∏–∫–∞ —Ä–∞–¥–∏–∫–∞–ª—å–Ω—ã—Ö —Ä–µ—Ñ–æ—Ä–º –ú.–°. –ì–æ—Ä–±–∞—á—ë–≤–∞?'
            },
            // 9-11 –∫–ª–∞—Å—Å - –°—Ä–µ–¥–Ω–∏–π
            '4_medium': {
                1: '–ß—Ç–æ —Ç–∞–∫–æ–µ "—Ö–æ–ª–æ–¥–Ω–∞—è –≤–æ–π–Ω–∞"?',
                2: '–í —á—ë–º —Å—É—Ç—å –∫–æ–ª–ª–µ–∫—Ç–∏–≤–∏–∑–∞—Ü–∏–∏ –≤ –°–°–°–†?',
                3: '–ß—Ç–æ —Ç–∞–∫–æ–µ "–ª–µ–Ω–∏–Ω–≥—Ä–∞–¥—Å–∫–æ–µ –¥–µ–ª–æ"?',
                4: '–ö–∞–∫–æ–≤—ã –±—ã–ª–∏ –≥–ª–∞–≤–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã –§–µ–≤—Ä–∞–ª—å—Å–∫–æ–π —Ä–µ–≤–æ–ª—é—Ü–∏–∏ 1917 –≥–æ–¥–∞?'
            },
            // 9-11 –∫–ª–∞—Å—Å - –°–ª–æ–∂–Ω—ã–π
            '4_hard': {
                1: '–ö–∞–∫–æ–≤—ã –±—ã–ª–∏ –≥–ª–∞–≤–Ω—ã–µ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è –ë—Ä–µ—Å—Ç—Å–∫–æ–≥–æ –º–∏—Ä–∞ 1918 –≥–æ–¥–∞ –¥–ª—è –†–æ—Å—Å–∏–∏?',
                2: '–í —á—ë–º –∑–∞–∫–ª—é—á–∞–ª–∞—Å—å —Å—É—Ç—å "—à–æ–∫–æ–≤–æ–π —Ç–µ—Ä–∞–ø–∏–∏" –≤ —ç–∫–æ–Ω–æ–º–∏–∫–µ –†–æ—Å—Å–∏–∏ 1990-—Ö –≥–æ–¥–æ–≤?',
                3: '–ß—Ç–æ —Ç–∞–∫–æ–µ "–¥–∏—Å—Å–∏–¥–µ–Ω—Ç—Å–∫–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ" –≤ –°–°–°–†?',
                4: '–ö–∞–∫–æ–≤—ã –±—ã–ª–∏ –≥–ª–∞–≤–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã –∏ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è –ö–∞—Ä–∏–±—Å–∫–æ–≥–æ –∫—Ä–∏–∑–∏—Å–∞ 1962 –≥–æ–¥–∞?'
            },
            // 7-8 –∫–ª–∞—Å—Å - –õ—ë–≥–∫–∏–π
            '3_easy': {
                1: '–ö–∞–∫–æ–π —Ä—É—Å—Å–∫–∏–π —Ü–∞—Ä—å –ø—Ä–æ—Ä—É–±–∏–ª "–æ–∫–Ω–æ –≤ –ï–≤—Ä–æ–ø—É"?',
                2: '–ö—Ç–æ –±—ã–ª –≥–ª–∞–≤–Ω–æ–∫–æ–º–∞–Ω–¥—É—é—â–∏–º —Ä—É—Å—Å–∫–æ–π –∞—Ä–º–∏–µ–π –≤ 1812 –≥–æ–¥—É?',
                3: '–ö–∞–∫ –Ω–∞–∑—ã–≤–∞–ª–∞—Å—å –≤–æ–π–Ω–∞ 1812 –≥–æ–¥–∞?',
                4: '–ö—Ç–æ —Ç–∞–∫–∞—è –ï–∫–∞—Ç–µ—Ä–∏–Ω–∞ II?'
            },
            // 7-8 –∫–ª–∞—Å—Å - –°—Ä–µ–¥–Ω–∏–π
            '3_medium': {
                1: '–ü–æ—á–µ–º—É –≤–æ–π–Ω–∞ 1812 –≥–æ–¥–∞ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –û—Ç–µ—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–π?',
                2: '–í —á—ë–º –≥–ª–∞–≤–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞ –æ—Ç–º–µ–Ω—ã –∫—Ä–µ–ø–æ—Å—Ç–Ω–æ–≥–æ –ø—Ä–∞–≤–∞ –≤ 1861 –≥–æ–¥—É?',
                3: '–ß—Ç–æ —Ç–∞–∫–æ–µ "–°–µ–≤–µ—Ä–Ω–∞—è –≤–æ–π–Ω–∞" –∏ —Å –∫–µ–º –æ–Ω–∞ –≤–µ–ª–∞—Å—å?',
                4: '–ö—Ç–æ —Ç–∞–∫–∏–µ "–¥–µ–∫–∞–±—Ä–∏—Å—Ç—ã"?'
            },
            // 7-8 –∫–ª–∞—Å—Å - –°–ª–æ–∂–Ω—ã–π
            '3_hard': {
                1: '–ß—Ç–æ —Ç–∞–∫–æ–µ "–≤–æ–µ–Ω–Ω—ã–µ –ø–æ—Å–µ–ª–µ–Ω–∏—è" –ø—Ä–∏ –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–µ I?',
                2: '–í —á—ë–º —Å—É—Ç—å "–ü—Ä–æ—Å–≤–µ—â—ë–Ω–Ω–æ–≥–æ –∞–±—Å–æ–ª—é—Ç–∏–∑–º–∞" –ï–∫–∞—Ç–µ—Ä–∏–Ω—ã II?',
                3: '–ö–∞–∫–æ–≤—ã –±—ã–ª–∏ –≥–ª–∞–≤–Ω—ã–µ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è –¶–µ—Ä–∫–æ–≤–Ω–æ–≥–æ —Ä–∞—Å–∫–æ–ª–∞ XVII –≤–µ–∫–∞?',
                4: '–ß—Ç–æ —Ç–∞–∫–æ–µ "–±–∏—Ä–æ–Ω–æ–≤—â–∏–Ω–∞"?'
            }
        };
        
        function getQuestionText(level, questionNum) {
            if (QUESTIONS_DB[level] && QUESTIONS_DB[level][questionNum]) {
                return QUESTIONS_DB[level][questionNum];
            }
            return `–í–æ–ø—Ä–æ—Å ${questionNum}`;
        }
        
        document.getElementById('authForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const key = document.getElementById('teacherKey').value.trim();
            const errorMessage = document.getElementById('errorMessage');
            
            if (!key) {
                showError('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–ª—é—á –¥–æ—Å—Ç—É–ø–∞');
                return;
            }
            
            try {
                const response = await fetch('/api/verify-key', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ key })
                });
                
                const result = await response.json();
                
                if (result.status === 'success') {
                    errorMessage.style.display = 'none';
                    allData = result.data;
                    showResults(result.data);
                } else {
                    showError(result.message || '–ù–µ–≤–µ—Ä–Ω—ã–π –∫–ª—é—á –¥–æ—Å—Ç—É–ø–∞');
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                showError('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
            }
        });
        
        function showError(message) {
            const errorMessage = document.getElementById('errorMessage');
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
        }
        
        function showResults(data) {
            document.getElementById('authSection').style.display = 'none';
            document.getElementById('resultsSection').style.display = 'block';
            
            const classesContainer = document.getElementById('classesContainer');
            const statsBar = document.getElementById('statsBar');
            
            // –ü–æ–¥—Å—á—ë—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
            let totalResults = 0;
            let totalClasses = Object.keys(data).length;
            let totalCorrect = 0;
            let totalQuestions = 0;
            
            for (const className in data) {
                totalResults += data[className].length;
                data[className].forEach(student => {
                    totalCorrect += student.score;
                    totalQuestions += student.max_score;
                });
            }
            
            const avgPercent = totalQuestions > 0 ? Math.round((totalCorrect / totalQuestions) * 100) : 0;
            
            // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
            statsBar.innerHTML = `
                <div class="stat-item">
                    <div class="stat-number">${totalClasses}</div>
                    <div class="stat-label">–ö–ª–∞—Å—Å–æ–≤</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">${totalResults}</div>
                    <div class="stat-label">–†–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">${avgPercent}%</div>
                    <div class="stat-label">–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</div>
                </div>
            `;
            
            // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ –∫–ª–∞—Å—Å–∞–º
            if (totalClasses === 0) {
                classesContainer.innerHTML = '<div class="no-results">–ü–æ–∫–∞ –Ω–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</div>';
                document.getElementById('globalStatsSection').style.display = 'none';
                return;
            }
            
            let html = '';
            
            // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∫–ª–∞—Å—Å–æ–≤
            const sortedClasses = Object.keys(data).sort((a, b) => {
                const numA = parseInt(a.replace(/\D/g, '')) || 0;
                const numB = parseInt(b.replace(/\D/g, '')) || 0;
                if (numA !== numB) return numA - numB;
                return a.localeCompare(b);
            });
            
            sortedClasses.forEach((className, classIndex) => {
                const students = data[className];
                
                html += `
                    <div class="class-card" style="animation-delay: ${classIndex * 0.1}s">
                        <div class="class-header">
                            <div class="class-name">–ö–ª–∞—Å—Å ${escapeHtml(className)}</div>
                            <div class="student-count">${students.length} ${getStudentWord(students.length)}</div>
                        </div>
                        <table class="results-table">
                            <thead>
                                <tr>
                                    <th>–ò–º—è</th>
                                    <th>–§–∞–º–∏–ª–∏—è</th>
                                    <th>–£—Ä–æ–≤–µ–Ω—å</th>
                                    <th>–†–µ–∑—É–ª—å—Ç–∞—Ç</th>
                                </tr>
                            </thead>
                            <tbody>
                `;
                
                students.forEach((student, studentIndex) => {
                    const scoreClass = getScoreClass(student.score, student.max_score);
                    const levelName = getLevelName(student.level);
                    const studentId = `student-${classIndex}-${studentIndex}`;
                    const percent = Math.round((student.score / student.max_score) * 100);
                    
                    html += `
                        <tr class="student-row" onclick="toggleDetails('${studentId}')" id="row-${studentId}">
                            <td>${escapeHtml(student.first_name)} <span class="expand-icon">‚ñº</span></td>
                            <td>${escapeHtml(student.last_name)}</td>
                            <td><span class="level-badge">${levelName}</span></td>
                            <td><span class="score-badge ${scoreClass}">${student.score}/${student.max_score} (${percent}%)</span></td>
                        </tr>
                    `;
                    
                    // –î–µ—Ç–∞–ª–∏ —É—á–µ–Ω–∏–∫–∞
                    html += `
                        <tr>
                            <td colspan="4" style="padding: 0; border: none;">
                                <div class="student-details" id="${studentId}">
                                    <div class="details-header">
                                        üìù –ü–æ–¥—Ä–æ–±–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤:
                                    </div>
                                    <div class="answers-list">
                    `;
                    
                    if (student.answers && Array.isArray(student.answers)) {
                        student.answers.forEach((answerObj, i) => {
                            const isCorrect = answerObj.correct;
                            const blockClass = isCorrect ? 'correct-block' : 'incorrect-block';
                            const icon = isCorrect ? '‚úÖ' : '‚ùå';
                            const userAnswer = answerObj.answer ? answerObj.answer.toUpperCase() : '‚Äî';
                            const correctAnswer = answerObj.correct_answer ? answerObj.correct_answer.toUpperCase() : '';
                            const questionText = getQuestionText(student.level, i + 1);
                            
                            html += `
                                <div class="question-block ${blockClass}">
                                    <div class="question-header">
                                        <span class="question-icon">${icon}</span>
                                        <div class="question-content">
                                            <div class="question-title">–í–æ–ø—Ä–æ—Å ${i + 1}</div>
                                            <div class="question-text-full">${escapeHtml(questionText)}</div>
                                            <div class="answer-info">
                                                ${isCorrect ? `
                                                    <span class="answer-label correct-answer">–û—Ç–≤–µ—Ç: ${userAnswer} ‚úì</span>
                                                ` : `
                                                    <span class="answer-label wrong-answer">–û—Ç–≤–µ—Ç —É—á–µ–Ω–∏–∫–∞: ${userAnswer}</span>
                                                    <span class="answer-label correct-answer">–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: ${correctAnswer}</span>
                                                `}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            `;
                        });
                    } else {
                        html += '<div style="color: #8892b0;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ–± –æ—Ç–≤–µ—Ç–∞—Ö</div>';
                    }
                    
                    html += `
                                    </div>
                                </div>
                            </td>
                        </tr>
                    `;
                });
                
                html += `
                            </tbody>
                        </table>
                        <div class="click-hint">–ù–∞–∂–º–∏—Ç–µ –Ω–∞ —Å—Ç—Ä–æ–∫—É —É—á–µ–Ω–∏–∫–∞, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏</div>
                `;
                
                // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–ª—è –∫–ª–∞—Å—Å–∞
                html += generateClassStats(students, className);
                
                html += `
                    </div>
                `;
            });
            
            classesContainer.innerHTML = html;
            
            // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ–±—â–µ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
            showGlobalStats(data);
        }
        
        function generateClassStats(students, className) {
            let questionStats = {};
            
            // –°–æ–±–∏—Ä–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –∫–ª–∞—Å—Å—É
            students.forEach(student => {
                const level = student.level;
                
                // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –≤–æ–ø—Ä–æ—Å–∞–º
                if (!questionStats[level]) {
                    questionStats[level] = {};
                }
                
                if (student.answers && Array.isArray(student.answers)) {
                    student.answers.forEach((answerObj, i) => {
                        const qNum = i + 1;
                        if (!questionStats[level][qNum]) {
                            questionStats[level][qNum] = { correct: 0, incorrect: 0, total: 0 };
                        }
                        questionStats[level][qNum].total++;
                        if (answerObj.correct) {
                            questionStats[level][qNum].correct++;
                        } else {
                            questionStats[level][qNum].incorrect++;
                        }
                    });
                }
            });
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
            if (Object.keys(questionStats).length === 0) {
                return '';
            }
            
            // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —É—Ä–æ–≤–Ω–µ–π
            const sortedLevels = Object.keys(questionStats).sort();
            
            let html = `
                <div class="class-stats-section">
                    <div class="class-stats-header">
                        <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–ª–∞—Å—Å–∞ ${escapeHtml(className)}</h3>
                    </div>
                    
                    <div class="class-questions-stats">
                        <div class="class-stats-title">üìù –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –≤–æ–ø—Ä–æ—Å–∞–º</div>
            `;
            
            sortedLevels.forEach(level => {
                const levelName = getLevelName(level);
                const qStats = questionStats[level];
                
                if (!qStats || Object.keys(qStats).length === 0) return;
                
                html += `
                    <div class="test-level-group class-test-group">
                        <div class="test-level-title">${levelName}</div>
                `;
                
                // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –ø–æ –Ω–æ–º–µ—Ä—É
                const sortedQuestions = Object.keys(qStats).sort((a, b) => parseInt(a) - parseInt(b));
                
                sortedQuestions.forEach(qNum => {
                    const stat = qStats[qNum];
                    const correctPercent = stat.total > 0 ? Math.round((stat.correct / stat.total) * 100) : 0;
                    const incorrectPercent = 100 - correctPercent;
                    const questionText = getQuestionText(level, parseInt(qNum));
                    
                    html += `
                        <div class="question-stat-item class-question-stat">
                            <div class="question-stat-header">
                                <div class="question-stat-text">
                                    <span class="question-stat-number">–í–æ–ø—Ä–æ—Å ${qNum}:</span>
                                    ${escapeHtml(questionText)}
                                </div>
                                <div class="question-stat-respondents">${stat.total} –æ—Ç–≤.</div>
                            </div>
                            <div class="question-stat-bar-container">
                                <div class="question-stat-bar">
                                    ${correctPercent > 0 ? `<div class="question-stat-bar-correct" style="width: ${correctPercent}%">${correctPercent}%</div>` : ''}
                                    ${incorrectPercent > 0 ? `<div class="question-stat-bar-incorrect">${incorrectPercent}%</div>` : ''}
                                </div>
                            </div>
                            <div class="question-stat-legend">
                                <div class="legend-item">
                                    <span class="legend-dot correct"></span>
                                    <span class="legend-text">–ü—Ä–∞–≤–∏–ª—å–Ω–æ: ${stat.correct}</span>
                                </div>
                                <div class="legend-item">
                                    <span class="legend-dot incorrect"></span>
                                    <span class="legend-text">–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ: ${stat.incorrect}</span>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                html += '</div>';
            });
            
            html += '</div></div>';
            
            return html;
        }
        
        function showGlobalStats(data) {
            const section = document.getElementById('globalStatsSection');
            
            let totalCorrect = 0;
            let totalQuestions = 0;
            let totalResults = 0;
            let excellentCount = 0;
            let goodCount = 0;
            let averageCount = 0;
            let poorCount = 0;
            
            for (const className in data) {
                data[className].forEach(student => {
                    totalCorrect += student.score;
                    totalQuestions += student.max_score;
                    totalResults++;
                    
                    const percent = (student.score / student.max_score) * 100;
                    if (percent >= 90) excellentCount++;
                    else if (percent >= 70) goodCount++;
                    else if (percent >= 50) averageCount++;
                    else poorCount++;
                });
            }
            
            const avgPercent = totalQuestions > 0 ? Math.round((totalCorrect / totalQuestions) * 100) : 0;
            const avgClass = avgPercent >= 90 ? 'excellent' : avgPercent >= 70 ? 'good' : avgPercent >= 50 ? 'average' : 'poor';
            
            let html = `
                <div class="global-stats-header">
                    <h2>–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –≤—Å–µ–º –∫–ª–∞—Å—Å–∞–º</h2>
                </div>
                
                <div class="stats-grid">
                    <div class="stats-card">
                        <div class="stats-card-value ${avgClass}">${avgPercent}%</div>
                        <div class="stats-card-label">–°—Ä–µ–¥–Ω–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤</div>
                    </div>
                    <div class="stats-card">
                        <div class="stats-card-value neutral">${totalCorrect}/${totalQuestions}</div>
                        <div class="stats-card-label">–í—Å–µ–≥–æ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤</div>
                    </div>
                    <div class="stats-card">
                        <div class="stats-card-value excellent">${excellentCount}</div>
                        <div class="stats-card-label">–û—Ç–ª–∏—á–Ω–æ (90%+)</div>
                    </div>
                    <div class="stats-card">
                        <div class="stats-card-value good">${goodCount}</div>
                        <div class="stats-card-label">–•–æ—Ä–æ—à–æ (70-89%)</div>
                    </div>
                    <div class="stats-card">
                        <div class="stats-card-value average">${averageCount}</div>
                        <div class="stats-card-label">–£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ (50-69%)</div>
                    </div>
                    <div class="stats-card">
                        <div class="stats-card-value poor">${poorCount}</div>
                        <div class="stats-card-label">–ù–µ—É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ (<50%)</div>
                    </div>
                </div>
                
                <div class="global-stats-hint">
                    <p>üìä –ü–æ–¥—Ä–æ–±–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –≤–æ–ø—Ä–æ—Å–∞–º –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ –∫–∞–∂–¥–æ–≥–æ –∫–ª–∞—Å—Å–∞</p>
                </div>
            `;
            
            section.innerHTML = html;
            section.style.display = 'block';
        }
        
        function toggleDetails(studentId) {
            const details = document.getElementById(studentId);
            const row = document.getElementById('row-' + studentId);
            
            if (details.classList.contains('visible')) {
                details.classList.remove('visible');
                row.classList.remove('expanded');
            } else {
                // –ó–∞–∫—Ä—ã—Ç—å –≤—Å–µ –¥—Ä—É–≥–∏–µ –æ—Ç–∫—Ä—ã—Ç—ã–µ –¥–µ—Ç–∞–ª–∏
                document.querySelectorAll('.student-details.visible').forEach(el => {
                    el.classList.remove('visible');
                });
                document.querySelectorAll('.student-row.expanded').forEach(el => {
                    el.classList.remove('expanded');
                });
                
                details.classList.add('visible');
                row.classList.add('expanded');
            }
        }
        
        function getScoreClass(score, maxScore) {
            const percent = (score / maxScore) * 100;
            if (percent >= 90) return 'score-excellent';
            if (percent >= 70) return 'score-good';
            if (percent >= 50) return 'score-average';
            return 'score-poor';
        }
        
        function getLevelName(level) {
            const levels = {
                '4_easy': '–õ—ë–≥–∫–∏–π (4 –≤–æ–ø—Ä–æ—Å–∞)',
                '6_medium': '–°—Ä–µ–¥–Ω–∏–π (6 –≤–æ–ø—Ä–æ—Å–æ–≤)',
                '8_hard': '–°–ª–æ–∂–Ω—ã–π (8 –≤–æ–ø—Ä–æ—Å–æ–≤)',
                '5_easy': '–õ—ë–≥–∫–∏–π (5 –≤–æ–ø—Ä–æ—Å–æ–≤)',
                '7_medium': '–°—Ä–µ–¥–Ω–∏–π (7 –≤–æ–ø—Ä–æ—Å–æ–≤)',
                '10_hard': '–°–ª–æ–∂–Ω—ã–π (10 –≤–æ–ø—Ä–æ—Å–æ–≤)',
                '3_easy': '–õ—ë–≥–∫–∏–π (3 –≤–æ–ø—Ä–æ—Å–∞)',
                '4_medium': '–°—Ä–µ–¥–Ω–∏–π (4 –≤–æ–ø—Ä–æ—Å–∞)',
                '5_medium': '–°—Ä–µ–¥–Ω–∏–π (5 –≤–æ–ø—Ä–æ—Å–æ–≤)'
            };
            
            if (levels[level]) {
                return levels[level];
            }
            
            // –ü–æ–ø—ã—Ç–∫–∞ —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å
            const match = level.match(/^(\d+)_(\w+)$/);
            if (match) {
                const num = match[1];
                const difficulty = match[2];
                const difficultyRu = {
                    'easy': '–õ—ë–≥–∫–∏–π',
                    'medium': '–°—Ä–µ–¥–Ω–∏–π',
                    'hard': '–°–ª–æ–∂–Ω—ã–π'
                };
                const diffName = difficultyRu[difficulty] || difficulty;
                return `${diffName} (${num} ${getQuestionWord(parseInt(num))})`;
            }
            
            return level;
        }
        
        function getQuestionWord(count) {
            const lastDigit = count % 10;
            const lastTwoDigits = count % 100;
            
            if (lastTwoDigits >= 11 && lastTwoDigits <= 19) {
                return '–≤–æ–ø—Ä–æ—Å–æ–≤';
            }
            
            if (lastDigit === 1) {
                return '–≤–æ–ø—Ä–æ—Å';
            }
            
            if (lastDigit >= 2 && lastDigit <= 4) {
                return '–≤–æ–ø—Ä–æ—Å–∞';
            }
            
            return '–≤–æ–ø—Ä–æ—Å–æ–≤';
        }
        
        function getStudentWord(count) {
            const lastDigit = count % 10;
            const lastTwoDigits = count % 100;
            
            if (lastTwoDigits >= 11 && lastTwoDigits <= 19) {
                return '—Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤';
            }
            
            if (lastDigit === 1) {
                return '—Ä–µ–∑—É–ª—å—Ç–∞—Ç';
            }
            
            if (lastDigit >= 2 && lastDigit <= 4) {
                return '—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞';
            }
            
            return '—Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤';
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        function logout() {
            document.getElementById('authSection').style.display = 'block';
            document.getElementById('resultsSection').style.display = 'none';
            document.getElementById('teacherKey').value = '';
            document.getElementById('classesContainer').innerHTML = '';
            document.getElementById('statsBar').innerHTML = '';
            document.getElementById('globalStatsSection').innerHTML = '';
            allData = null;
        }
    </script>
</body>
</html>

# Изменения в проекте

## Исправленные ошибки

### 1. Ошибка отображения страниц
**Проблема:** Несоответствие между путями в коде (`high-school-student`) и реальными папками (`HighSchoolStudent`, `MiddleSchoolStudent`)

**Решение:** Обновлены пути в `main.py`:
- `high-school-student/` → `HighSchoolStudent/`
- `middle-school-student/` → `MiddleSchoolStudent/`

### 2. Отсутствие маршрута для приёма данных
**Проблема:** HTML отправлял данные на `/api/submit-test`, но этого маршрута не существовало

**Решение:** Добавлен POST-маршрут `/api/submit-test` в `main.py` для приёма и обработки данных теста

### 3. Проблемы с данными формы
**Проблема:** HTML отправлял поле `class` вместо `className` и не отправлял ответы пользователя

**Решение:** 
- Обновлены все HTML файлы (6 файлов) для отправки правильных данных
- Добавлена отправка массива ответов с информацией о правильности
- Добавлена отправка времени выполнения теста

## Добавленная функциональность

### 1. Инициализация базы данных
- База данных автоматически инициализируется при запуске приложения
- Создаётся таблица `Test` с правильной структурой

### 2. Сохранение результатов в БД
**Реализовано:**
- Функция `save_test_result()` в `DBmanager.py` для сохранения данных
- Сохранение: имя, фамилия, класс, ответы (JSON), баллы, уровень, время, дата
- Информативные логи в консоли при сохранении

### 3. Получение данных из БД
**Реализовано:**
- Функция `get_all_tests()` - получение всех результатов
- Функция `get_test_by_id()` - получение результата по ID
- Автоматическое преобразование JSON ответов

### 4. Обработка ошибок
- Try-except блоки во всех критических местах
- Информативные сообщения об ошибках в консоли и для пользователя
- Валидация обязательных полей перед сохранением

## Структура проекта

```
E:\Python\Sites\School\
├── main.py                 # Главный файл приложения Flask
├── DBmanager.py            # Менеджер базы данных
├── database.db             # SQLite база данных
├── requirements.txt        # Зависимости проекта
└── templates/
    ├── HighSchoolStudent/  # Тесты для 9-11 классов
    │   ├── first.html      # Тяжелый уровень
    │   ├── second.html     # Средний уровень
    │   └── third.html      # Легкий уровень
    └── MiddleSchoolStudent/ # Тесты для 7-8 классов
        ├── first.html      # Легкий уровень
        ├── second.html     # Тяжелый уровень
        └── third.html      # Средний уровень
```

## API Endpoints

### GET маршруты (отображение страниц)
- `/test/high-school-student/first` - Тест 9-11 класс (Тяжелый)
- `/test/high-school-student/second` - Тест 9-11 класс (Средний)
- `/test/high-school-student/third` - Тест 9-11 класс (Легкий)
- `/test/middle-school-student/first` - Тест 7-8 класс (Легкий)
- `/test/middle-school-student/second` - Тест 7-8 класс (Тяжелый)
- `/test/middle-school-student/third` - Тест 7-8 класс (Средний)

### POST маршруты (приём данных)
- `/api/submit-test` - Сохранение результатов теста

**Формат запроса:**
```json
{
  "firstName": "Имя",
  "lastName": "Фамилия",
  "className": "9А",
  "answers": [
    {"question": 1, "answer": "b", "correct": true},
    {"question": 2, "answer": "b", "correct": true},
    {"question": 3, "answer": "b", "correct": true},
    {"question": 4, "answer": "b", "correct": true}
  ],
  "testLevel": "4_hard",
  "score": 4,
  "maxScore": 4,
  "time": 6,
  "timestamp": "2025-12-01T18:50:23.000Z"
}
```

**Формат ответа (успех):**
```json
{
  "status": "success",
  "message": "Результаты теста успешно сохранены",
  "test_id": 1
}
```

## База данных

### Структура таблицы Test
| Поле | Тип | Описание |
|------|-----|----------|
| id | INTEGER | Уникальный идентификатор (автоинкремент) |
| first_name | TEXT | Имя ученика |
| last_name | TEXT | Фамилия ученика |
| class_name | TEXT | Класс (например, "9А") |
| answers | TEXT | JSON массив ответов |
| score | INTEGER | Количество правильных ответов |
| level | TEXT | Уровень теста (например, "4_hard") |
| time | INTEGER | Время выполнения в секундах |
| created_at | TIMESTAMP | Дата и время прохождения теста |

## Запуск приложения

```bash
# Установка зависимостей
pip install -r requirements.txt

# Запуск сервера
python main.py
```

Сервер запустится на `http://localhost:5000`

